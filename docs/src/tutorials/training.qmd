# ConformalTraining

```@meta
CurrentModule = ConformalPrediction
```

```{julia}
#| echo: false
using Pkg; Pkg.activate("docs")
using Plots
theme(:wong)
using Random
Random.seed!(2022)
www_path = "docs/src/www"   # output path for files don't get automatically saved in auto-generated path (e.g. GIFs)
```


```{julia}
using MLJ
using Random
Random.seed!(123)

# Data:
X, y = make_moons(500; noise=0.15)
X = MLJ.table(Float32.(MLJ.matrix(X)))
train, test = partition(eachindex(y), 0.8, shuffle=true)
```


```{julia}
using MLJFlux
using ConformalPrediction
using ConformalPrediction.ConformalTraining: ConformalNNClassifier

# Model:
builder = MLJFlux.MLP(hidden=(32, 32, 32,), Ïƒ=Flux.relu)
clf = ConformalNNClassifier(epochs=250, builder=builder, batch_size=50)
# clf = NeuralNetworkClassifier(epochs=250, builder=builder, batch_size=50)
```


```{julia}
using ConformalPrediction

conf_model = conformal_model(clf; method=:simple_inductive)
mach = machine(conf_model, X, y)
fit!(mach, rows=train)
```

```{julia}
#| output: true

using Plots
p_proba = contourf(mach.model, mach.fitresult, X, y)
p_set_size = contourf(mach.model, mach.fitresult, X, y; plot_set_size=true)
plot(p_proba, p_set_size, size=(800,250))
```

